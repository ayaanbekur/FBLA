{% extends "base.html" %}

{% block content %}
<h2 class="mb-4"><i class="fas fa-comments"></i> Chat with Moneyy</h2>

<div class="card">
    <div class="card-body">
        <div id="chat-box" style="height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px;">
            <!-- Chat messages will appear here -->
        </div>
        <form id="chat-form">
            <div class="mb-3">
                <input type="text" class="form-control" id="user-message" placeholder="Type your message here..." required>
            </div>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-paper-plane"></i> Send
            </button>
        </form>
    </div>
</div>

<script>
    const chatBox = document.getElementById("chat-box");
    const chatForm = document.getElementById("chat-form");
    const userMessageInput = document.getElementById("user-message");

    chatForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const userMessage = userMessageInput.value.trim();

        if (userMessage) {
            addMessage("You", userMessage);
            userMessageInput.value = ""; // Clear input field

<<<<<<< HEAD
            try {
                const response = await fetch("/chat", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ message: userMessage }),
                });

                if (!response.ok) throw new Error("Failed to get response");
=======
            // Send the message to the server
            const response = await fetch("https://personal-finance-manager-sg7m.onrender.com/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ message: userMessage }),
            });
>>>>>>> 3e2914d735dd3de77cd31ecedcc606e4bfcc3678

                const data = await response.json();
                
                // Debugging: Log the full response object
                console.log("AI Response:", data);

                // Extract and display AI response
                const aiResponse = typeof data.response === "string" ? data.response : JSON.stringify(data.response);
                addMessage("Moneyy", aiResponse);

            } catch (error) {
                addMessage("Error", error.message);
            }

            // Auto-scroll to bottom
            setTimeout(() => {
                chatBox.scrollTop = chatBox.scrollHeight;
            }, 100);
        }
    });

    // Function to add messages to the chat box
    function addMessage(sender, message) {
        const messageElement = document.createElement("div");
        messageElement.innerHTML = `<strong>${sender}:</strong> ${message}`;
        chatBox.appendChild(messageElement);
    }
</script>
<<<<<<< HEAD

=======
>>>>>>> 3e2914d735dd3de77cd31ecedcc606e4bfcc3678
{% endblock %}
